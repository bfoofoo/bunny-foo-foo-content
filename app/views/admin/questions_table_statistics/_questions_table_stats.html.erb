<div class="table_tools">
  <ul class="scopes table_tools_segmented_control" >
    <li class="scope all selected">
      <%= link_to "Total Statistics", admin_questions_statistics_path, class:  "table_tools_button" %>
    </li>

    <li class="scope all">
      <%= link_to "Affiliates Statistics", admin_questions_affiliate_statistics_path, class:  "table_tools_button" %>
    </li>

    <li class="scope all">
      <%= link_to "Subaffilates Statistics", admin_questions_subaffiliate_statistics_path, class:  "table_tools_button" %>
    </li>
  </ul>
</div>

<%- if table_stats.blank? %>
  <h2>There is no questions for selected Leadgen Site.</h2>
<% else %>
  <%- binding.pry %>
  <table class="index_table index">
    <thead>
      <tr>
        <th>Question</th>

        <%- 
          key = table_stats.keys.first 
          answers = table_stats[key].keys
        %>

        <%- answers.each do |answer| %>
          <th><%= answer %></th>  
        <% end %>

      </tr>
    </thead>
    <tbody>
      <tr>
        <%- %> table_stats
      </tr>


      <%- formsites_statistics.converted_counts_hash.each do |formsite_name, stats| %>
        <tr>
          <td><%= link_to formsite_name, admin_formsite_users_path(q: {formsite_id_eq: stats[:formsite]}) %></td>
          <td><%= link_to stats[:total], admin_formsite_users_path(formsites_statistics.query_params_hash(stats, {is_duplicate_eq: nil})) %></td>
          <td><%= link_to stats[:submitted], admin_formsite_users_path(formsites_statistics.query_params_hash(stats, {user_id_not_null: true})) %></td>
          <td><%= link_to stats[:total_converted], admin_formsite_users_path(
                formsites_statistics.query_params_hash(stats, {user_id_not_null: true, is_verified_eq: true})
              ) %>
          </td>
          <td><%= link_to stats[:failed_impressionwise], admin_formsite_users_path(
                formsites_statistics.query_params_hash(stats, {user_id_not_null: true, is_impressionwise_test_success_eq: false})
              ) %>
          </td>

          <td><%= link_to stats[:failed_useragent], admin_formsite_users_path(
                formsites_statistics.query_params_hash(stats, {user_id_not_null: true, is_useragent_valid_eq: false})
              ) %>
          </td>

          <td><%= link_to stats[:failed_dulpicate], admin_formsite_users_path(
                formsites_statistics.query_params_hash(stats, {user_id_not_null: true, is_duplicate_eq: true})
              ) %>
          </td>
          
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
